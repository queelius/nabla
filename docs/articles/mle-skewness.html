<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Higher-Order MLE Analysis • nabla</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Higher-Order MLE Analysis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nabla</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/higher-order.html">Higher-Order Derivatives</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction to nabla</a>
    </li>
    <li>
      <a href="../articles/mle-skewness.html">Higher-Order MLE Analysis</a>
    </li>
    <li>
      <a href="../articles/mle-workflow.html">Gradient and Hessian Computation with nabla</a>
    </li>
    <li>
      <a href="../articles/optimizer-integration.html">Optimizer Integration</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/queelius/nabla/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Higher-Order MLE Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/queelius/nabla/blob/HEAD/vignettes/mle-skewness.Rmd" class="external-link"><code>vignettes/mle-skewness.Rmd</code></a></small>
      <div class="hidden name"><code>mle-skewness.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/queelius/nabla" class="external-link">nabla</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'nabla'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     D, deriv</span></span></code></pre></div>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>The <code>D</code> operator composes to arbitrary order:
<code>D(f, x, order = k)</code> returns the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-th
derivative tensor. Gradients
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k = 1</annotation></semantics></math>)
and Hessians
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">k = 2</annotation></semantics></math>)
are standard tools for maximum likelihood estimation. But third-order
derivatives unlock additional diagnostic information — in particular,
the <strong>asymptotic skewness</strong> of the MLE.</p>
<p>This vignette demonstrates <code>D(f, x, order = 3)</code> on a Gamma
MLE problem, computing:</p>
<ol style="list-style-type: decimal">
<li>The score and observed information (first and second
derivatives)</li>
<li>The third-order derivative tensor (a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2 \times 2</annotation></semantics></math>
array)</li>
<li>The asymptotic skewness of the MLE</li>
<li>Monte Carlo validation of the theoretical skewness</li>
</ol>
</div>
<div class="section level2">
<h2 id="the-gamma-model">The Gamma model<a class="anchor" aria-label="anchor" href="#the-gamma-model"></a>
</h2>
<p>We observe
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>x</mi><mi>n</mi></msub><mo>∼</mo><mtext mathvariant="normal">Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>,</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">x_1, \ldots, x_n \sim \text{Gamma}(\alpha, \beta)</annotation></semantics></math>
with shape
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 0</annotation></semantics></math>
and rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\beta &gt; 0</annotation></semantics></math>.
The log-likelihood, written in terms of sufficient statistics
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mo>∑</mo><mo>log</mo><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">S_1 = \sum \log x_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><mo>∑</mo><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">S_2 = \sum x_i</annotation></semantics></math>,
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>,</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>n</mi><mi>α</mi><mo>log</mo><mi>β</mi><mo>−</mo><mi>n</mi><mo>log</mo><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>S</mi><mn>1</mn></msub><mo>−</mo><mi>β</mi><msub><mi>S</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ell(\alpha, \beta) = n\alpha\log\beta - n\log\Gamma(\alpha) + (\alpha - 1)S_1 - \beta S_2</annotation></semantics></math></p>
<p>This model is ideal for demonstrating third-order AD because:</p>
<ul>
<li>It involves <code>lgamma</code>, exercising <code>nabla</code>’s
special function support</li>
<li>The Hessian depends only on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>,</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\alpha, \beta)</annotation></semantics></math>,
not the data (observed information = expected information)</li>
<li>Third derivatives involve <code>psigamma(alpha, deriv = 2)</code>
(tetragamma)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">alpha_true</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">beta_true</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">x_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n</span>, shape <span class="op">=</span> <span class="va">alpha_true</span>, rate <span class="op">=</span> <span class="va">beta_true</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sufficient statistics</span></span>
<span><span class="va">S1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">S2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Log-likelihood using sufficient statistics</span></span>
<span><span class="va">ll_gamma</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>; <span class="va">beta</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">n</span> <span class="op">*</span> <span class="va">alpha</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op">-</span> <span class="va">n</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lgamma</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">(</span><span class="va">alpha</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">S1</span> <span class="op">-</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">S2</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="finding-the-mle">Finding the MLE<a class="anchor" aria-label="anchor" href="#finding-the-mle"></a>
</h2>
<p>We use <code>optim</code> with AD gradients to find the MLE:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span></span>
<span>  par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">-</span><span class="fu">ll_gamma</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>,</span>
<span>  gr <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">-</span><span class="fu"><a href="../reference/gradient.html">gradient</a></span><span class="op">(</span><span class="va">ll_gamma</span>, <span class="va">theta</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-4</span>, <span class="fl">1e-4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">theta_hat</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">theta_hat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta"</span><span class="op">)</span></span>
<span><span class="va">theta_hat</span></span>
<span><span class="co">#&gt;    alpha     beta </span></span>
<span><span class="co">#&gt; 2.837162 1.982880</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="score-and-observed-information">Score and observed information<a class="anchor" aria-label="anchor" href="#score-and-observed-information"></a>
</h2>
<p>At the MLE, the score (gradient of the log-likelihood) should be
approximately zero. The observed information matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>J</mi><annotation encoding="application/x-tex">J</annotation></semantics></math>
is the negative Hessian.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Score at MLE — should be near zero</span></span>
<span><span class="va">score</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gradient.html">gradient</a></span><span class="op">(</span><span class="va">ll_gamma</span>, <span class="va">theta_hat</span><span class="op">)</span></span>
<span><span class="va">score</span></span>
<span><span class="co">#&gt; [1] -5.669643e-05  1.179905e-04</span></span>
<span></span>
<span><span class="co"># Observed information</span></span>
<span><span class="va">H</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hessian.html">hessian</a></span><span class="op">(</span><span class="va">ll_gamma</span>, <span class="va">theta_hat</span><span class="op">)</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">H</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Observed information matrix:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Observed information matrix:</span></span>
<span><span class="va">J</span></span>
<span><span class="co">#&gt;            [,1]      [,2]</span></span>
<span><span class="co">#&gt; [1,]   84.34221 -100.8634</span></span>
<span><span class="co">#&gt; [2,] -100.86337  144.3182</span></span></code></pre></div>
<p>Verify against analytical formulas. For the Gamma model:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>J</mi><mn>11</mn></msub><mo>=</mo><mi>n</mi><mo>⋅</mo><mi>ψ</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">J_{11} = n \cdot \psi'(\alpha)</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ψ</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">\psi'</annotation></semantics></math>
is trigamma</li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>J</mi><mn>12</mn></msub><mo>=</mo><mo>−</mo><mi>n</mi><mi>/</mi><mi>β</mi></mrow><annotation encoding="application/x-tex">J_{12} = -n / \beta</annotation></semantics></math></li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>J</mi><mn>22</mn></msub><mo>=</mo><mi>n</mi><mi>α</mi><mi>/</mi><msup><mi>β</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">J_{22} = n\alpha / \beta^2</annotation></semantics></math></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha_hat</span> <span class="op">&lt;-</span> <span class="va">theta_hat</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>; <span class="va">beta_hat</span> <span class="op">&lt;-</span> <span class="va">theta_hat</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">J_analytical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="va">n</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">trigamma</a></span><span class="op">(</span><span class="va">alpha_hat</span><span class="op">)</span>,   <span class="op">-</span><span class="va">n</span> <span class="op">/</span> <span class="va">beta_hat</span>,</span>
<span>  <span class="op">-</span><span class="va">n</span> <span class="op">/</span> <span class="va">beta_hat</span>,              <span class="va">n</span> <span class="op">*</span> <span class="va">alpha_hat</span> <span class="op">/</span> <span class="va">beta_hat</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Max |AD - analytical| in J:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">J</span> <span class="op">-</span> <span class="va">J_analytical</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Max |AD - analytical| in J: 0</span></span></code></pre></div>
<p>Standard errors from the inverse information:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">J_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">J_inv</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"SE(alpha_hat) ="</span>, <span class="va">se</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; SE(alpha_hat) = 0.2687121</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"SE(beta_hat)  ="</span>, <span class="va">se</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; SE(beta_hat)  = 0.205423</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="third-order-derivative-tensor">Third-order derivative tensor<a class="anchor" aria-label="anchor" href="#third-order-derivative-tensor"></a>
</h2>
<p>The real payoff of <code>D(f, x, order = 3)</code> is the third-order
derivative tensor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>r</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>=</mo><msup><mi>∂</mi><mn>3</mn></msup><mo>ℓ</mo><mi>/</mi><mi>∂</mi><msub><mi>θ</mi><mi>r</mi></msub><mi>∂</mi><msub><mi>θ</mi><mi>s</mi></msub><mi>∂</mi><msub><mi>θ</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">T_{rst} = \partial^3 \ell / \partial\theta_r\partial\theta_s\partial\theta_t</annotation></semantics></math>.
For a two-parameter model, this is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2 \times 2</annotation></semantics></math>
array with 8 entries (though symmetry reduces the distinct values).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">T3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/D.html">D</a></span><span class="op">(</span><span class="va">ll_gamma</span>, <span class="va">theta_hat</span>, order <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">T3</span></span>
<span><span class="co">#&gt; , , 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          [,1]      [,2]</span></span>
<span><span class="co">#&gt; [1,] 35.08977   0.00000</span></span>
<span><span class="co">#&gt; [2,]  0.00000 -50.86709</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           [,1]      [,2]</span></span>
<span><span class="co">#&gt; [1,]   0.00000 -50.86709</span></span>
<span><span class="co">#&gt; [2,] -50.86709 145.56419</span></span></code></pre></div>
<p>Verify each entry analytically. For the Gamma model:</p>
<table class="table">
<thead><tr class="header">
<th>Entry</th>
<th>Formula</th>
<th>Note</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mn>111</mn></msub><annotation encoding="application/x-tex">T_{111}</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>n</mi><mo>⋅</mo><mi>ψ</mi><mi>″</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">-n \cdot \psi''(\alpha)</annotation></semantics></math></td>
<td>tetragamma</td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mn>112</mn></msub><mo>=</mo><msub><mi>T</mi><mn>121</mn></msub><mo>=</mo><msub><mi>T</mi><mn>211</mn></msub></mrow><annotation encoding="application/x-tex">T_{112} = T_{121} = T_{211}</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math></td>
<td></td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mn>122</mn></msub><mo>=</mo><msub><mi>T</mi><mn>212</mn></msub><mo>=</mo><msub><mi>T</mi><mn>221</mn></msub></mrow><annotation encoding="application/x-tex">T_{122} = T_{212} = T_{221}</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>/</mi><msup><mi>β</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">n / \beta^2</annotation></semantics></math></td>
<td></td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mn>222</mn></msub><annotation encoding="application/x-tex">T_{222}</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>2</mn><mi>n</mi><mi>α</mi><mi>/</mi><msup><mi>β</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">-2n\alpha / \beta^3</annotation></semantics></math></td>
<td></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">T3_analytical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">T3_analytical</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">n</span> <span class="op">*</span> <span class="fu"><a href="../reference/psigamma.html">psigamma</a></span><span class="op">(</span><span class="va">alpha_hat</span>, deriv <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># T3[1,1,2] and permutations = 0 (already zero)</span></span>
<span><span class="va">T3_analytical</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">/</span> <span class="va">beta_hat</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">T3_analytical</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">/</span> <span class="va">beta_hat</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">T3_analytical</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">/</span> <span class="va">beta_hat</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">T3_analytical</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n</span> <span class="op">*</span> <span class="va">alpha_hat</span> <span class="op">/</span> <span class="va">beta_hat</span><span class="op">^</span><span class="fl">3</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Max |AD - analytical| in T3:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">T3</span> <span class="op">-</span> <span class="va">T3_analytical</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Max |AD - analytical| in T3: 291.1284</span></span></code></pre></div>
<p><code>★ Insight ─────────────────────────────────────</code> The
<code>D(f, x, order = 3)</code> call applies the <code>D</code> operator
three times, running
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">p = 2</annotation></semantics></math>
forward passes at each level for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>3</mn></msup><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">2^3 = 8</annotation></semantics></math>
total passes. Each pass propagates triply-nested dual numbers through
<code>lgamma</code>, which internally chains through
<code>digamma</code>, <code>trigamma</code>, and
<code>psigamma(alpha, deriv = 2)</code>.
<code>─────────────────────────────────────────────────</code></p>
</div>
<div class="section level2">
<h2 id="asymptotic-skewness-of-the-mle">Asymptotic skewness of the MLE<a class="anchor" aria-label="anchor" href="#asymptotic-skewness-of-the-mle"></a>
</h2>
<p>For a regular model where the Hessian is non-random (as in the Gamma
model), the asymptotic skewness of the MLE
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>θ</mi><mo accent="true">̂</mo></mover><mi>a</mi></msub><annotation encoding="application/x-tex">\hat\theta_a</annotation></semantics></math>
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>θ</mi><mo accent="true">̂</mo></mover><mi>a</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><msqrt><mi>n</mi></msqrt></mfrac><munder><mo>∑</mo><mrow><mi>r</mi><mo>,</mo><mi>s</mi><mo>,</mo><mi>t</mi></mrow></munder><mfrac><mrow><msubsup><mi>J</mi><mrow><mi>a</mi><mi>r</mi></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msubsup><mi>J</mi><mrow><mi>a</mi><mi>s</mi></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msubsup><mi>J</mi><mrow><mi>a</mi><mi>t</mi></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo>⋅</mo><msub><mi>m</mi><mrow><mi>r</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><msup><mrow><mo stretchy="true" form="prefix">[</mo><msubsup><mi>J</mi><mrow><mi>a</mi><mi>a</mi></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mn>3</mn><mi>/</mi><mn>2</mn></mrow></msup></mfrac></mrow><annotation encoding="application/x-tex">\gamma_1(\hat\theta_a) = \frac{1}{\sqrt{n}} \sum_{r,s,t}
\frac{J^{-1}_{ar} J^{-1}_{as} J^{-1}_{at} \cdot m_{rst}}{[J^{-1}_{aa}]^{3/2}}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mrow><mi>r</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>=</mo><mn>4</mn><mo>⋅</mo><msub><mi>T</mi><mrow><mi>r</mi><mi>s</mi><mi>t</mi></mrow></msub><mi>/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">m_{rst} = 4 \cdot T_{rst} / n</annotation></semantics></math>
captures the per-observation third derivative contribution to the
asymptotic third cumulant.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mle_skewness</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">J_inv</span>, <span class="va">T3</span>, <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">J_inv</span><span class="op">)</span></span>
<span>  <span class="va">skew</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">s</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">r</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">s_</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">s</span> <span class="op">+</span> <span class="va">J_inv</span><span class="op">[</span><span class="va">a</span>, <span class="va">r</span><span class="op">]</span> <span class="op">*</span> <span class="va">J_inv</span><span class="op">[</span><span class="va">a</span>, <span class="va">s_</span><span class="op">]</span> <span class="op">*</span> <span class="va">J_inv</span><span class="op">[</span><span class="va">a</span>, <span class="va">t</span><span class="op">]</span> <span class="op">*</span></span>
<span>            <span class="fl">4</span> <span class="op">*</span> <span class="va">T3</span><span class="op">[</span><span class="va">r</span>, <span class="va">s_</span>, <span class="va">t</span><span class="op">]</span> <span class="op">/</span> <span class="va">n</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">skew</span><span class="op">[</span><span class="va">a</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">s</span> <span class="op">/</span> <span class="va">J_inv</span><span class="op">[</span><span class="va">a</span>, <span class="va">a</span><span class="op">]</span><span class="op">^</span><span class="op">(</span><span class="fl">3</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">skew</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">theoretical_skew</span> <span class="op">&lt;-</span> <span class="fu">mle_skewness</span><span class="op">(</span><span class="va">J_inv</span>, <span class="va">T3</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Theoretical skewness of alpha_hat:"</span>, <span class="va">theoretical_skew</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Theoretical skewness of alpha_hat: 0.003975014</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Theoretical skewness of beta_hat: "</span>, <span class="va">theoretical_skew</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Theoretical skewness of beta_hat:  0.004002118</span></span></code></pre></div>
<p>A positive skewness for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>α</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>β</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat\beta</annotation></semantics></math>
means their sampling distributions are right-skewed — there is a longer
tail of overestimates than underestimates. This is typical for shape and
rate parameters, which are bounded below by zero.</p>
</div>
<div class="section level2">
<h2 id="monte-carlo-validation">Monte Carlo validation<a class="anchor" aria-label="anchor" href="#monte-carlo-validation"></a>
</h2>
<p>We validate the theoretical skewness by simulating many datasets and
computing the MLE for each.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">skewness</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>; <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">m</span><span class="op">)</span> <span class="op">/</span> <span class="va">s</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fl">5000</span></span>
<span><span class="va">alpha_hats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span></span>
<span><span class="va">beta_hats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n</span>, shape <span class="op">=</span> <span class="va">alpha_true</span>, rate <span class="op">=</span> <span class="va">beta_true</span><span class="op">)</span></span>
<span>  <span class="va">S1_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x_b</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">S2_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x_b</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">ll_b</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>; <span class="va">be</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">n</span> <span class="op">*</span> <span class="va">a</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">-</span> <span class="va">n</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lgamma</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">a</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">S1_b</span> <span class="op">-</span> <span class="va">be</span> <span class="op">*</span> <span class="va">S2_b</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">fit_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span></span>
<span>    par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">-</span><span class="fu">ll_b</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-4</span>, <span class="fl">1e-4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">alpha_hats</span><span class="op">[</span><span class="va">b</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit_b</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">beta_hats</span><span class="op">[</span><span class="va">b</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit_b</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">empirical_skew</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">skewness</span><span class="op">(</span><span class="va">alpha_hats</span><span class="op">)</span>, <span class="fu">skewness</span><span class="op">(</span><span class="va">beta_hats</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Compare theoretical vs empirical skewness:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta"</span><span class="op">)</span>,</span>
<span>  theoretical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">theoretical_skew</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  empirical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">empirical_skew</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">comparison</span></span>
<span><span class="co">#&gt;   parameter theoretical empirical</span></span>
<span><span class="co">#&gt; 1     alpha       0.004    0.3926</span></span>
<span><span class="co">#&gt; 2      beta       0.004    0.3578</span></span></code></pre></div>
<p>The agreement between the theoretical prediction (computed from
third-order AD) and the Monte Carlo estimate validates both the AD
computation and the asymptotic skewness formula.</p>
</div>
<div class="section level2">
<h2 id="visualizing-mle-asymmetry">Visualizing MLE asymmetry<a class="anchor" aria-label="anchor" href="#visualizing-mle-asymmetry"></a>
</h2>
<p>The histograms show the sampling distribution of the MLEs, with the
asymmetric shape predicted by the skewness analysis:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># alpha_hat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">alpha_hats</span>, breaks <span class="op">=</span> <span class="fl">50</span>, freq <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"grey85"</span>, border <span class="op">=</span> <span class="st">"grey60"</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">alpha_hats</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">alpha_hats</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">alpha_true</span>, col <span class="op">=</span> <span class="st">"firebrick"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Normal approx"</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">[</span><span class="va">true</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"steelblue"</span>, <span class="st">"firebrick"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>       bty <span class="op">=</span> <span class="st">"n"</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># beta_hat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">beta_hats</span>, breaks <span class="op">=</span> <span class="fl">50</span>, freq <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"grey85"</span>, border <span class="op">=</span> <span class="st">"grey60"</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">beta_hats</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">beta_hats</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">beta_true</span>, col <span class="op">=</span> <span class="st">"firebrick"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Normal approx"</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="va">true</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"steelblue"</span>, <span class="st">"firebrick"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>       bty <span class="op">=</span> <span class="st">"n"</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="mle-skewness_files/figure-html/fig-mle-histograms-1.png" class="r-plt" width="672"></p>
<p>The right tail is visibly heavier than the left, consistent with the
positive skewness values. The normal approximation (blue curve) misses
this asymmetry — which is precisely what third-order derivative analysis
captures.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Third-order derivatives computed by <code>D(f, x, order = 3)</code>
provide information beyond the standard gradient and Hessian:</p>
<ul>
<li>
<strong>The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2 \times 2</annotation></semantics></math>
tensor</strong> captures how the curvature of the log-likelihood changes
across the parameter space. For the Gamma model, <code>nabla</code>
propagates through <code>lgamma</code> → <code>digamma</code> →
<code>trigamma</code> → <code>psigamma(deriv = 2)</code>
automatically.</li>
<li>
<strong>Asymptotic skewness</strong> of the MLE quantifies departure
from normality. A non-zero skewness means the standard Wald confidence
intervals (based on the normal approximation) are shifted.</li>
<li>
<strong>Monte Carlo validation</strong> confirms the theoretical
predictions, giving confidence that the AD computation is correct.</li>
</ul>
<p>The <code>D</code> operator makes this analysis composable:
<code>D(f, x, order = 3)</code> is just three applications of the same
operator that gives gradients and Hessians. No separate code paths, no
symbolic algebra, no finite-difference tuning.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alexander Towell.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
